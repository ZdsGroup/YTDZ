<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/common.css"/>
		<link rel="stylesheet" href="../../css/font-awesome.min.css" />
		<link rel="stylesheet" href="../../css/yt.css" />
		<style type="text/css">
			.mui-input-group {
				position: absolute;
				height: 36px;
				top: 6px;
				right: 75px;
				left: 50px;
			}
			
			.mui-input-row .mui-input-clear~.mui-icon-clear,
			.mui-input-row .mui-input-password~.mui-icon-eye,
			.mui-input-row .mui-input-speech~.mui-icon-speech {
				/*font-size: 20px;*/
				position: absolute;
				z-index: 1;
				/*top: 10px;
				right: 0;*/
				width: 38px;
				height: 36px;
				text-align: center;
				color: #999;
				padding-top: 5px;
			}
			.searchlist-addr,.ytfooter-user, .ytfooter-tel{
				width: 20px;	
				color: lightgreen;
			}
			.searchlist-local{
				width: 20px;	
				color: lightblue;
			}
			#searchlist .mui-table-view-cell{
			    padding-bottom: 5px;
			    padding-top: 5px;
			}
			#searchlist h5{
				color: black;
			}


		</style>
	</head>

	<body>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/template-native.js" ></script>
		<script type="text/javascript" src="../../js/testdata.js" ></script>
		<script type="text/javascript">
			mui.init({
				//初始化下拉加载
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: pulldownRefresh //下拉，获取更多数据
					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh //上拉， 刷新最新数据
					}
				}
			});
			//下拉刷新具体业务实现
			function pulldownRefresh() {
				setTimeout(function() {
					var html = template('ul-li-template', {
						list: searchListData
					});
					document.getElementById("searchlist").innerHTML = html;
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
				}, 500);
			}
			var count = 0;
			//上拉加载具体业务实现
			function pullupRefresh() {
				setTimeout(function() {
					mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
					var html = template('ul-li-template', {
						list: searchListData
					});
					document.getElementById("searchlist").innerHTML = document.getElementById("searchlist").innerHTML + html;
				}, 500);
			}
			var nativeWebview, imm, InputMethodManager;
			var initNativeObjects = function() {
				if(mui.os.android) {
					var main = plus.android.runtimeMainActivity();
					var Context = plus.android.importClass("android.content.Context");
					InputMethodManager = plus.android.importClass("android.view.inputmethod.InputMethodManager");
					imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);
				} else {
					nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
				}
			};
			var showSoftInput = function() {
				var nativeWebview = plus.webview.currentWebview().nativeInstanceObject();
				if(mui.os.android) {
					//强制当前webview获得焦点
					plus.android.importClass(nativeWebview);
					nativeWebview.requestFocus();
					imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);
				} else {
					nativeWebview.plusCallMethod({
						"setKeyboardDisplayRequiresUserAction": false
					});
				}
				setTimeout(function() {
					//此处可写具体逻辑设置获取焦点的input
					var inputElem = document.querySelector('#search-input-id');
					inputElem.focus();
				}, 100);
			};
			
			var initApp = function() {
				initNativeObjects();
				showSoftInput();
				this.initEvent();
			};
			
			if(mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
					}, 300);
					initApp();
				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
					initApp();
				});
			}
			
			//添加列表项的点击事件
			var initEvent = function() {
				
				mui(".mui-table-view").on('tap', '.mui-table-view-cell', function(e) {
					var info = e.target.parentElement.parentElement;
					//把选中的info.id(type_id)传到详情页面
					var typeT = info.id.split('_')[0];
					var idT = info.id.split('_')[1];
					//定位到具体的告警tab
					var tabT = 'warn'
					openInfoPage(typeT,idT,tabT);
				});
				
				//根据类型和id打开对应的设备详情页面
				function openInfoPage(typeT,idT,tabT){
					var pageUrl = '';
					var pageId = '';
					switch(typeT) {
						case 'bmwyjc':
							{
								pageUrl = '../../pages/jcsb/bmwyjc.html';
								pageId = 'bmwyjc';
								break;
							}
						case 'lfjc':
							{
								pageUrl = '../../pages/jcsb/lfjc.html';
								pageId = 'lfjc';
								break;
							}
						case 'yljc':
							{
								pageUrl = '../../pages/jcsb/yljc.html';
								pageId = 'yljc';
								break;
							}
						default:
							break;
					}
					mui.openWindow({
						url: pageUrl,
						id: pageId,
						extras:{
							xjType: typeT,
							xjID: idT,
							xjTab: tabT 
						}
					});
				}
			}
		</script>
		<header class="mui-bar mui-bar-nav" style="background-color: rgba(236, 240, 241,1.0);">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: #000000;"></a>
			<form class="mui-input-group">
				<div class="mui-input-row ">
					<input id="search-input-id" type="text" class="mui-input-clear mui-input-speech mui-input-search" placeholder="地灾点、设备">
				</div>
			</form>
			<button type="button" class="mui-btn mui-btn-blue mui-pull-right">搜索</button>
		</header>
		<!--下拉刷新容器-->
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<!--数据列表-->
				<ul id="searchlist" class="mui-table-view">
					<script id="ul-li-template" type="text/html">
						<% for(var i=0;i<list.length;i++){%>
						<li id='<%=list[i].type%>_<%=list[i].id%>' class="mui-table-view-cell">
							<div id="list-table" class="mui-table">
								<div class="mui-table-cell mui-col-xs-1 mui-text-left">
									<span class="mui-h5 mapfooterfont4 searchlist-local"></span>
								</div>
								<div class="mui-table-cell mui-col-xs-11">
									<h5 ><%=list[i].name%></h5>
									<h6><span class="mapfooterfont4 searchlist-addr"></span> <span> 鹰潭市xxx村 </span>
										<span class="mapfooterfont4 ytfooter-user"></span><span> 王克 </span>
					                    	<span class="mapfooterfont4 ytfooter-tel"></span> 18901023458 
									</h6>
								</div>
								
							</div>
						</li>
						<%}%>
					</script>
				</ul>
			</div>
		</div>
	</body>

</html>